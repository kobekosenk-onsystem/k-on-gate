<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>K-on! Gateway</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="text-align:center; padding-top:100px; font-family:sans-serif; background-color:#f4f4f4;">
  <div id="loading-area">
    <p>軽音部部室予約システムを起動中...</p>
    <div style="margin: 20px auto; width: 30px; height: 30px; border: 3px solid #ddd; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
  </div>
  
  <div id="error-area" style="display:none; padding: 20px;">
    <p>自動起動に失敗しました</p>
    <button onclick="location.reload()" style="padding:10px 20px;">再試行</button>
  </div>

  <style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>

  <script>
    const LIFF_ID = "2008880240-ln3wSnTk"; 
    const GAS_URL = "https://script.google.com/macros/s/AKfycbx0gQXbe86ygAkaqhpHzlDe6DTM7lOi-GTK-MAXEQjXD6F0ox_PdJ29SfQingCOPl70Qw/exec";

    // 6秒経っても動かない場合はエラー表示
    setTimeout(() => {
      if(document.getElementById('loading-area').style.display !== 'none') {
        document.getElementById('error-area').style.display = 'block';
      }
    }, 6000);

    window.onload = function() {
      liff.init({ liffId: LIFF_ID }).then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          liff.getProfile().then(p => {
            // 履歴を上書き（replace）してGASへ飛ばす
            window.location.replace(GAS_URL + "?uid=" + p.userId);
          });
        }
      }).catch(err => {
        document.getElementById('loading-area').innerHTML = "起動エラー: " + err;
      });
    };
  </script>
</body>
</html>
